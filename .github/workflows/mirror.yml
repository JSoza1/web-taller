name: Sincronizar Espejo a SozaSystems

on:
  push:
    branches: [ main ]

jobs:
  mirror:
    if: github.repository == 'JSoza1/web-electricista'
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout del código
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # ESTO ES VITAL: Evita que GitHub use su token por defecto
          persist-credentials: false 

      - name: Sincronizar con SozaSystems
        env:
          TOKEN: ${{ secrets.BUSINESS_REPO_TOKEN }}
        run: |
          # 1. Configurar identidad
          git config --global user.name "Jsoza1"
          git config --global user.email "jsoza993@gmail.com"
          
          # 2. Eliminar workflows para que el destino esté limpio
          rm -rf .github/workflows
          git add .
          git commit -m "Mirror: Limpieza de workflows" || echo "Sin cambios"
          
          # 3. Limpiar cualquier credencial que haya quedado en el entorno
          git config --local --unset-all http.https://github.com/.extraheader || true
          
          # 4. Push forzado usando el token directamente
          # Aquí forzamos la autenticación en la URL
          git push --force https://Jsoza1:${TOKEN}@github.com/SozaSystems/web-electricista.git main
